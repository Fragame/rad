"use strict";(self.webpackChunkmy_book=self.webpackChunkmy_book||[]).push([[8401],{9955:(e,r,o)=>{o.r(r),o.d(r,{default:()=>d});var t=o(6540),a=o(5166),n=o(6347),i=o(8193),s=o(8478),l=o(4848);const c=()=>{const[e,r]=(0,t.useState)({ChapterNotes:null,AudioReader:null,ThemeSwitcher:null});if((0,t.useEffect)(()=>{Promise.all([o.e(8496).then(o.bind(o,8496)),o.e(5523).then(o.bind(o,5523)),o.e(3230).then(o.bind(o,3230))]).then(([e,o,t])=>{r({ChapterNotes:e.default,AudioReader:o.default,ThemeSwitcher:t.default})})},[]),!e.ChapterNotes)return null;const{ChapterNotes:a,AudioReader:n,ThemeSwitcher:i}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(a,{}),(0,l.jsx)(n,{}),(0,l.jsx)(i,{})]})};const d=function(e){const[r,o]=(0,t.useState)(!1),[d,m]=(0,t.useState)(""),[u,h]=(0,t.useState)(""),[p,g]=(0,t.useState)(!1),[f,b]=(0,t.useState)({isAuthenticated:!1,user:{}}),x=(0,n.zy)();(0,t.useEffect)(()=>{if(i.A.canUseDOM){const e=localStorage.getItem("authToken"),r=localStorage.getItem("user");b({isAuthenticated:!!e,user:r?JSON.parse(r):{}})}},[]);const v=()=>{const e=x.pathname;return"/"===e?"intro.md":e.substring(1)+".md"},y=async()=>{if(!i.A.canUseDOM)return;g(!0);const e=localStorage.getItem("authToken"),r=v();try{const o=await fetch(`http://localhost:3001/api/chapters/${r}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({content:d})});if(o.ok)alert("Capitolo salvato con successo! La pagina verr\xe0 ricaricata."),window.location.reload();else{const e=await o.json();alert("Errore nel salvataggio: "+e.error)}}catch(o){alert("Errore di connessione: "+o.message)}finally{g(!1)}},j=()=>{i.A.canUseDOM&&(localStorage.removeItem("authToken"),localStorage.removeItem("user"),window.location.reload())};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(a.A,{...e}),(0,l.jsx)(s.A,{fallback:(0,l.jsx)("div",{children:"Loading..."}),children:()=>(0,l.jsxs)(l.Fragment,{children:[f.isAuthenticated&&"editor"===f.user.role&&(0,l.jsxs)("div",{style:{marginTop:"3rem",padding:"1.5rem",background:"var(--ifm-color-emphasis-100)",borderRadius:"8px",border:"1px solid var(--ifm-color-emphasis-200)"},children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:r?"1rem":0},children:[(0,l.jsx)("div",{children:r?(0,l.jsx)("h3",{style:{margin:0},children:"Editor Capitolo"}):(0,l.jsx)("button",{onClick:()=>{(async()=>{if(!i.A.canUseDOM)return;const e=localStorage.getItem("authToken"),r=v();try{const o=await fetch(`http://localhost:3001/api/chapters/${r}`,{headers:{Authorization:`Bearer ${e}`}});if(o.ok){const e=await o.json();m(e.content),h(e.content)}}catch(o){console.error("Errore caricamento contenuto:",o)}})(),o(!0)},style:{background:"var(--ifm-color-primary)",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"4px",cursor:"pointer",marginRight:"1rem"},children:"\u270f\ufe0f Modifica Capitolo"})}),(0,l.jsxs)("div",{style:{fontSize:"0.9rem",color:"var(--ifm-color-emphasis-600)"},children:["\ud83d\udc64 ",f.user.username," |",(0,l.jsx)("button",{onClick:j,style:{background:"none",border:"none",color:"var(--ifm-color-primary)",cursor:"pointer",textDecoration:"underline",marginLeft:"0.5rem"},children:"Logout"})]})]}),r&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("textarea",{value:d,onChange:e=>m(e.target.value),style:{width:"100%",minHeight:"500px",fontFamily:"monospace",fontSize:"14px",padding:"1rem",border:"1px solid var(--ifm-color-emphasis-200)",borderRadius:"4px",background:"var(--ifm-background-color)",color:"var(--ifm-font-color-base)",resize:"vertical"}}),(0,l.jsxs)("div",{style:{marginTop:"1rem",display:"flex",gap:"1rem"},children:[(0,l.jsx)("button",{onClick:y,disabled:p,style:{background:"var(--ifm-color-success)",color:"white",border:"none",padding:"0.5rem 1.5rem",borderRadius:"4px",cursor:p?"not-allowed":"pointer",opacity:p?.6:1},children:p?"\u23f3 Salvando...":"\ud83d\udcbe Salva"}),(0,l.jsx)("button",{onClick:()=>{(d===u||confirm("Hai modifiche non salvate. Vuoi davvero annullare?"))&&(o(!1),m(""))},style:{background:"var(--ifm-color-danger)",color:"white",border:"none",padding:"0.5rem 1.5rem",borderRadius:"4px",cursor:"pointer"},children:"\u274c Annulla"}),(0,l.jsx)("button",{onClick:()=>m(u),disabled:d===u,style:{background:"var(--ifm-color-emphasis-200)",color:"var(--ifm-font-color-base)",border:"none",padding:"0.5rem 1.5rem",borderRadius:"4px",cursor:d===u?"not-allowed":"pointer",opacity:d===u?.5:1},children:"\u21a9\ufe0f Ripristina"})]}),(0,l.jsx)("div",{style:{marginTop:"1rem",fontSize:"0.85rem",color:"var(--ifm-color-emphasis-600)"},children:"\ud83d\udca1 Suggerimento: Usa Ctrl+S per salvare rapidamente (non implementato in questo esempio)"})]})]}),(0,l.jsx)(c,{})]})})]})}}}]);